; 18649 <Fall 2013>
; Group 22
; David Chow (davidcho)
; Brody Anderson (bcanders)
; Yang Liu (yangliu2)
; Jeff Lau (jalau)
;
; @Author: Yang Liu
; Integration test: SD7C - DoorControl and LanternControl Integration 

#INCLUDE defines.mf

;Initialize:
0s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
0s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true
0s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][LEFT]_CAN_ID DoorClosed BACK LEFT = true
0s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[BACK][RIGHT]_CAN_ID DoorClosed BACK RIGHT = true
0s I AT_FLOOR_PERIOD N AT_FLOOR_[4][FRONT]_CAN_ID AtFloor 4 FRONT = true 
0s I DOOR_CONTROL_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 4 UP FRONT
0s I DOOR_CONTROL_PERIOD N DRIVE_SPEED_CAN_ID DriveSpeed = 0 STOP
0s I DOOR_CONTROL_PERIOD N DESIRED_DWELL_[FRONT]_CAN_ID DesiredDwell FRONT = 2s

0.21s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = false
0.21s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = false
0.21s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][LEFT]_CAN_ID DoorOpened FRONT LEFT = true
0.21s I DOOR_OPENED_SENSOR_PERIOD N DOOR_OPEN_SENSOR_[FRONT][RIGHT]_CAN_ID DoorOpened FRONT RIGHT = true
0.21s I DOOR_CONTROL_PERIOD N DESIRED_FLOOR_CAN_ID DesiredFloor = 5 UP FRONT

3.61s A S DoorControl[FRONT][LEFT] : STATE == CLOSING_DOOR
3.61s A S DoorControl[FRONT][RIGHT] : STATE == CLOSING_DOOR

; arc 1
3.61s A F DoorMotor FRONT LEFT : command == CLOSE
3.61s A F DoorMotor FRONT RIGHT : command == CLOSE

; arc 2a
4.21s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][LEFT]_CAN_ID DoorClosed FRONT LEFT = true
4.21s I DOOR_CLOSED_SENSOR_PERIOD N DOOR_CLOSED_SENSOR_[FRONT][RIGHT]_CAN_ID DoorClosed FRONT RIGHT = true

;At state s1
6.83s A S DoorControl[FRONT][LEFT] : STATE == CAR_MOVING
6.83s A S DoorControl[FRONT][RIGHT] : STATE == CAR_MOVING

; arc 2b
6.83s A F DoorMotor FRONT LEFT : command == STOP
6.83s A F DoorMotor FRONT RIGHT : command == STOP

;arc 3
6.83s  A S LanternControl[UP] : STATE == STATE_LANTERN_OFF
6.83s  A F CarLantern UP : lighted == false
